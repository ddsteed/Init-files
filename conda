#!/usr/bin/env zsh
#-----------------------------------------------------------------------
# This script is to iniatize conda environment
#
# Author: Hao Feng (F1)
# Date:   Apr. 21, 2022
#
# Copyright (c) 2022, RDS
#
#
# For Apple M1 Silicon CPU:
#   - arm:
#       mforge:  miniforge
#       mbforge: mambaforge
#       ai:      AI envs
#       mconda:  miniconda3
#   - x86_64:
#       aconda:  anaconda3
#       rconda:  ROS envs
#-----------------------------------------------------------------------

runname=`basename $0`

conda_home=/opt/conda
ai_home=/opt/AI/envs
ros_home=/opt/ros/conda_venv

init_conda () {
    env=$1
    if [[ -f $env/etc/profile.d/conda.sh ]]; then
        source $env/etc/profile.d/conda.sh
        conda activate $env
    else
        echo
        echo "$env does NOT exist, create it firstly."
        echo "----------------------------------------------------"
        echo
    fi
}

case $runname in
    mforge)
        export condaenv=${conda_home}/miniforge3
        ;;
    mbforge)
        export condaenv=${conda_home}/mambaforge
        ;;
    ai | aiconda)
        export condaenv=${ai_home}
        ;;
    rconda)
        export condaenv=${ros_home}
        ;;
    mconda)
        export condaenv=${conda_home}/miniconda3
        export PATH=${conda_home}/miniconda3/bin:$PATH
        ;;
    aconda)
        export condaenv=${conda_home}/anaconda3
        export PATH=${conda_home}/anaconda3/bin:$PATH
        ;;
    conda)
        export condaenv=${conda_home}/anaconda3
        export PATH=${conda_home}/anaconda3/bin:$PATH
        ;;
esac
init_conda $condaenv

condabin=`dirname $CONDA_EXE`

condaup () {
    conda update --all -y
    # pip3 list --outdated --format=freeze | grep -v '^\-e' | cut -d = -f 1 | xargs -n1 pip3 install -U 
}

acondaup () {
  conda update anaconda --all -y
}

cdea () {
  conda deactivate
}

cact () {
  conda activate
}

cinfo () {
  conda info
}

cel () {
  conda env list
}

jnb () {
  $condabin/jupyter-notebook
}

jlab () {
  $condabin/jupyter-lab
}

pynv () {
  Open /Applications/Anaconda-Navigator.app
}

create_ai_env () {
    
    if [[ ! -f ${ai_home} ]]; then
        init_conda ${conda_home}/mambaforge
        conda create -y --prefix ${ai_home} mamba
    fi

    init_conda ${ai_home}

    app=(ipykernel
         pandas
         tensorflow
         seaborn
         statsmodels)

    mamba install -y -c conda-forge ${app[@]}

    pip_app=(scikit-learn)
    pip install --upgrade --force-reinstall ${pip_app[@]}
}
